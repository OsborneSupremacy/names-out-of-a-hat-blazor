@using NamesOutOfAHat2.Model.ViewModels
@using NamesOutOfAHat2.Utility

@*Display Mode*@
@if(_mode == Modes.Default)
{
    <div class="card mb-3" style="width: 18rem;display: inline-flex;margin: 10px;">
        <h5 class="card-header bg-info">@ParticipantViewModel.Person.Name.GetPersonEmojiFor() @ParticipantViewModel.Person.Name</h5>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">📧 @ParticipantViewModel.Person.Email</li>
            <li class="list-group-item">
                <label class="form-label"><b>🎁 Eligible Recipients</b></label>
                @foreach(var recipient in ParticipantViewModel.Recipients)
                {
                    <div class="form-check" style="text-align: left">
                        <input class="form-check-input" id='@(ParticipantViewModel.Person.Id + "_" + recipient.Person.Id)' type="checkbox" @bind="recipient.Eligible" />
                        <label class="form-check-label" for='@(ParticipantViewModel.Person.Id + "_" + recipient.Person.Id)' >@recipient.Person.Name</label>
                    </div>
                }
            </li>
            <li class="list-group-item">
                <a href="#" class="btn btn-sm btn-primary" @onclick="Edit" >Edit</a>&nbsp;
                <a href="#" class="btn btn-sm btn-danger" @onclick="Remove" >Remove</a>
            </li>
        </ul>
    </div>
}

@*Edit Mode*@
@if(_mode == Modes.Editing)
{
    <div class="card mb-3" style="width: 18rem;display: inline-flex;margin: 10px;">
        <h5 class="card-header bg-info">@ParticipantViewModel.WriteDisplayName()</h5>
        <div class="card-body">
            <EditForm Model="@ParticipantViewModel.Person" OnValidSubmit="@CommitParticipantEditAsync">
                <div class="form-floating mb-3">
                    <input id="PersonName" type="text" class="form-control" @bind-value="ParticipantViewModel.Person.Name" />
                    <label for="PersonName">Name</label>
                </div>
                <div class="form-floating mb-3">
                    <input id="PersonEmail" type="email" class="form-control" @bind-value="ParticipantViewModel.Person.Email" />
                    <label for="PersonEmail">Email</label>
                </div>
                <DataAnnotationsValidator />
                <ValidationSummary />
                <button type="submit" class="btn btn-sm btn-primary">Done</button>&nbsp;
            </EditForm>
        </div>
    </div>
}

@code {

    Modes _mode = Modes.Default;

    enum Modes
    {
        Default,
        Editing
    }

    void Edit() => _mode = Modes.Editing;

    public async Task Remove()
    {
        await ParticipantRemovedCallback.InvokeAsync(ParticipantViewModel);
    }

    void Display() => _mode = Modes.Default;

    [Parameter, EditorRequired]
    public ParticipantViewModel ParticipantViewModel { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<ParticipantViewModel> ParticpantEditedCallback { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<ParticipantViewModel> ParticipantRemovedCallback { get; set; }

    public async Task CommitParticipantEditAsync()
    {
        await ParticpantEditedCallback.InvokeAsync(ParticipantViewModel);
        Display();
    }

}