@page "/"

@using NamesOutOfAHat2.Model

<div class="bg-light rounded-3">
    <div class="container-fluid py-5">
        <div class="jumbotron">
            <h1 class="display-5">Put everyone's name in the hat!</h1>
        </div>

        @if(Mode == Modes.Default)
        {
            <p>
                <button type="button" @onclick="SwitchToAddMode" class="btn btn-primary">Add a Participant</button>
            </p>       
        }

        @if(Mode == Modes.Adding)
        {
            <AddParticipant Person="@NewPerson" PersonAddedCallback="@PersonAdded" CancelCallback="@Cancelled" />
        }

        @if (Hat.Participants?.Any() ?? false)
        {
            @foreach(var participant in Hat.Participants)
            {
                <ParticipantDisplay Participant="@participant" />
            }
        }

    </div>
</div>

@code {
    Person NewPerson;

    Hat Hat = new Hat();

    Modes Mode = Modes.Default;

    enum Modes
    {
        Default,
        Adding
    }

    void SwitchToAddMode()
    {
        NewPerson = new Person() { Id = System.Guid.NewGuid() };
        Mode = Modes.Adding;
    }

    void Cancelled()
    {
        Mode = Modes.Default;
    }

    void SwitchMode(Modes mode) => Mode = mode;

    private void PersonAdded(Person person)
    {
        Hat.Participants ??= new List<Participant>();

        var participant = new Participant();
        participant.Person = person;
        Hat.Participants.Add(participant);

        SwitchMode(Modes.Default);
    }

}